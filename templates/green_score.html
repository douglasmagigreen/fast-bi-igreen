{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block page_title %}Green Score por Fornecedora{% endblock %}

{% block head_extra %}
{{ super() }}
<style>
    /* Estilos existentes para o grid de velocímetros */
    .gauge-grid {
        display: grid;
        /* Define um número de colunas flexível, garantindo que os itens tenham um mínimo de 280px */
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px; /* Espaçamento entre os itens do grid (velocímetros e info cards) */
        justify-content: center; /* Centraliza o grid horizontalmente */
        align-items: stretch; /* Garante que todos os cards na linha tenham a mesma altura */
        padding: 20px;
        background-color: var(--cor-fundo-elemento);
        border-radius: 12px;
        box-shadow: var(--sombra-card);
        border: 1px solid var(--cor-borda-suave);
    }

    /* Estilo para cada card de velocímetro individual */
    /* Usar .card para o layout geral e .gauge-card para particularidades */
    .gauge-card, .info-card { /* Aplicar estilos comuns de card */
        background-color: var(--cor-fundo-elemento);
        border-radius: 10px; /* Levemente menor que o container geral */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Sombra mais leve */
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center; /* Centraliza conteúdo horizontalmente */
        justify-content: center; /* Centraliza conteúdo verticalmente */
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .gauge-card:hover, .info-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* Estilo para o contêiner do ApexCharts dentro do card */
    .gauge-chart-container {
        width: 100%; /* Ocupa a largura total do card */
        min-height: 250px; /* Altura mínima para o gráfico */
        display: flex; /* Para centralizar o gráfico internamente */
        justify-content: center;
        align-items: center;
    }

    /* Mensagem de carregamento/placeholder centralizada no grid */
    .gauge-grid .message-center {
        grid-column: 1 / -1; /* Ocupa todas as colunas */
        text-align: center;
        padding: 50px 20px;
        color: var(--cor-texto-secundario);
    }

    /* Estilos para os cards de informação (agora são apenas 'info-card',
       sem o container adicional que foi removido) */
    .info-card .card-header { /* Reutiliza o estilo do dashboard.css */
        padding: 12px 18px;
        background: linear-gradient(135deg, var(--cor-fundo-header-card), #f3f3f3);
        border-bottom: 1px solid var(--cor-borda-suave);
        font-weight: 500;
        color: var(--cor-texto-secundario);
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex; /* Para alinhar título e ícone */
        justify-content: space-between;
        align-items: center;
    }

    .info-card .card-body { /* Reutiliza o estilo do dashboard.css */
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .info-card .main-value { /* Reutiliza o estilo do dashboard.css */
        font-size: 2.6em;
        font-weight: 700;
        color: var(--cor-primaria);
        margin-bottom: 5px;
        line-height: 1.1;
    }

    .info-card .sub-label { /* Reutiliza o estilo do dashboard.css */
        display: block;
        color: var(--cor-texto-secundario);
        font-size: 0.9rem;
        margin-bottom: 0;
    }
    
    /* Para os "Clientes do Mês" com dois valores */
    .info-card .qualification-numbers { /* Reutiliza o estilo do dashboard.css */
        display: flex;
        justify-content: center;
        text-align: center;
        gap: 35px;
        align-items: flex-start;
        width: 100%;
    }
    .info-card .qual-item .qual-number { /* Reutiliza o estilo do dashboard.css */
        font-size: 2.2em;
        font-weight: 700;
        color: var(--cor-primaria);
        display: block;
        line-height: 1.1;
    }
    .info-card .qual-item .qual-label { /* Reutiliza o estilo do dashboard.css */
        font-size: 0.85em;
        color: var(--cor-texto-secundario);
        line-height: 1.3;
        margin-top: 3px;
    }

    /* Responsividade para info-cards-container - AGORA O gauge-grid FAZ ESTE PAPEL */
    @media (max-width: 768px) {
        .gauge-grid {
            grid-template-columns: 1fr; /* Uma coluna em telas menores */
            gap: 15px;
        }
    }

</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <p class="text-center text-muted mb-4">
        Selecione uma fornecedora ou a opção "Consolidado" para visualizar o Green Score de injeção.
    </p>

    <div class="filter-row justify-content-center mb-4">
        <div class="filter-group">
            <label for="fornecedora-filter">Selecione a Fornecedora:</label>
            <select id="fornecedora-filter" class="form-control" style="width: 300px;">
                <option value="">-- Selecione uma Fornecedora --</option>
                <option value="Consolidado">Consolidado (Todas as Fornecedoras)</option>
                {% for forn in fornecedoras %}
                    <option value="{{ forn }}">{{ forn }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    {# O gauge-container será o nosso grid principal para todos os cards #}
    <div id="gauge-container" class="gauge-grid" style="min-height: 300px;">
        {# Mensagem de placeholder inicial, que será removida/substituída por JS #}
        <div id="placeholder-message" class="message-center">
            <i class="fas fa-hand-pointer fa-2x mb-2"></i>
            <p>Aguardando a seleção de uma fornecedora ou consolidado...</p>
        </div>

        {# Cards de informação adicionais, agora dentro do mesmo grid #}
        {# Inicialmente display: none e depois controlados pelo JS #}
        {# Removido id="additional-info-container" e substituído por classe para ocultar individualmente #}
        <div class="info-card kpi-card additional-info-item" style="display: none;">
            <div class="card-header">
                Resultado do Mês
                <i class="fas fa-info-circle tooltip-icon" title="Soma do consumo médio dos clientes ativos no mês para esta fornecedora."></i>
            </div>
            <div class="card-body">
                <div class="main-value" id="info-kwh-vendidos">
                    <i class="fas fa-spinner fa-spin fa-sm"></i>
                </div>
                <div class="sub-label">kWh vendidos</div>
            </div>
        </div>

        {# Card: Clientes do Mês (Registrados / Ativados) #}
        <div class="info-card qualification-card additional-info-item" style="display: none;">
            <div class="card-header">
                Clientes do Mês
                <i class="fas fa-info-circle tooltip-icon" title="Contagem de clientes registrados e ativados no mês para esta fornecedora."></i>
            </div>
            <div class="card-body">
                <div class="qualification-numbers">
                    <div class="qual-item">
                        <span class="qual-number" id="info-clientes-registrados">
                            <i class="fas fa-spinner fa-spin fa-sm"></i>
                        </span>
                        <span class="qual-label">Registrados<br>no mês</span>
                    </div>
                    <div class="qual-item">
                        <span class="qual-number" id="info-clientes-ativados">
                            <i class="fas fa-spinner fa-spin fa-sm"></i>
                        </span>
                        <span class="qual-label">Ativados<br>no mês</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts_extra %}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        // Formatação de números para português do Brasil
        function formatNumber(num, decimalPlaces = 0) {
            if (typeof num !== 'number' || isNaN(num)) { return '0'; }
            return num.toLocaleString('pt-BR', {
                minimumFractionDigits: decimalPlaces,
                maximumFractionDigits: decimalPlaces
            });
        }
    </script>
    <script src="{{ url_for('static', filename='js/green_score.js') }}"></script>
{% endblock %}